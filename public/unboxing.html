<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PvZ GW2 - Unboxing Pack</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap');

        :root {
            --gold-shine: linear-gradient(to bottom, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --board-dark: #1a1f3a;
            --sticker-red: #c0392b;
            --pvz-green: #27ae60;
            --pvz-orange: #e67e22;
            --pvz-yellow: #f1c40f;
            --legendary-gold: #ffd700;
        }

        body {
            background: radial-gradient(circle at center, #0f1419 0%, #1a1f3a 50%, #000 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Luckiest Guy', cursive, sans-serif;
            overflow: hidden;
            color: white;
        }

        #shop-view {
            position: absolute;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .envelope-realistic {
            position: relative;
            width: 320px;
            height: 480px;
            background-size: cover;
            background-position: center;
            border: 12px solid transparent;
            border-image: var(--gold-shine) 1;
            box-shadow: 0 0 40px rgba(0,0,0,0.9), inset 0 0 20px rgba(255,255,255,0.2);
            cursor: pointer;
            background-blend-mode: soft-light;
            background-color: rgba(255,255,255,0.1);
            clip-path: polygon(0% 2%, 5% 0%, 10% 2%, 15% 0%, 20% 2%, 25% 0%, 30% 2%, 35% 0%, 40% 2%, 45% 0%, 50% 2%, 55% 0%, 60% 2%, 65% 0%, 70% 2%, 75% 0%, 80% 2%, 85% 0%, 90% 2%, 95% 0%, 100% 2%, 100% 98%, 95% 100%, 90% 98%, 85% 100%, 80% 98%, 75% 100%, 70% 98%, 65% 100%, 60% 98%, 55% 100%, 50% 98%, 45% 100%, 40% 98%, 35% 100%, 30% 98%, 25% 100%, 20% 98%, 15% 100%, 10% 98%, 5% 100%, 0% 98%);
        }

        .envelope-realistic::after {
            content: '';
            position: absolute;
            top: -100%; left: -100%; width: 300%; height: 300%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: moveShine 3s infinite linear paused;
        }

        .envelope-realistic:hover::after {
            animation-play-state: running;
        }

        @keyframes moveShine { 
            0% { transform: translateX(-100%) rotate(45deg); } 
            100% { transform: translateX(100%) rotate(45deg); } 
        }

        .star-abreme {
            position: absolute;
            top: -28px; right: -28px;
            width: 110px; height: 110px;
            background: radial-gradient(circle, var(--pvz-yellow), var(--pvz-orange));
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            display: flex;
            justify-content: center;
            align-items: center;
            transform: rotate(15deg);
            border: 3px solid white;
            box-shadow: 0 0 10px var(--pvz-yellow);
            z-index: 10;
            font-size: 0.95rem;
            font-weight: normal;
            text-shadow: 2px 2px 5px #000;
            color: white;
            padding: 0 12px;
            text-align: center;
            line-height: 1.15;
        }

        #album-view {
            width: 90vw; max-width: 1100px;
            height: 80vh; max-height: 600px;
            background: var(--board-dark);
            border: 15px solid #2c3e50;
            display: none;
            position: relative;
            padding: 40px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 100px rgba(0,0,0,0.5);
            border-radius: 15px;
            transition: filter 0.3s;
        }

        #hero-reveal {
            width: 40%;
            display: none;
            flex-direction: column;
            align-items: center;
        }

        .hero-banner {
            background: linear-gradient(45deg, var(--pvz-orange), #d68910);
            color: white;
            padding: 15px 40px;
            transform: rotate(-5deg);
            border: 4px solid white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            z-index: 5;
            margin-bottom: -20px;
            font-size: 1.8rem;
            text-shadow: 3px 3px 6px #000;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .hero-frame {
            width: 320px; height: 450px;
            background: linear-gradient(145deg, var(--pvz-orange), #b36900);
            border: 12px solid transparent;
            border-image: var(--gold-shine) 1;
            box-shadow: 0 0 80px var(--legendary-gold), inset 0 0 30px rgba(255,215,0,0.4);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .hero-frame:hover {
            box-shadow: 0 0 120px var(--legendary-gold), inset 0 0 50px rgba(255,215,0,0.6);
            transform: scale(1.02);
        }

        .hero-frame::before {
            content: 'LEGENDARIO';
            position: absolute;
            top: 10px; right: 10px;
            background: var(--legendary-gold);
            color: #8b0000;
            padding: 5px 15px;
            font-size: 0.9rem;
            font-weight: bold;
            transform: rotate(15deg);
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(255,215,0,0.8);
            z-index: 3;
        }

        .hero-frame::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.5), transparent);
            animation: shineHero 2s infinite;
        }

        @keyframes shineHero {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50%, 50%); }
        }

        #sticker-zone {
            width: 55%;
            height: 100%;
            position: relative;
            cursor: pointer;
            overflow: visible;
            display: block;   
        }

        .sticker {
            position: absolute;
            width: 200px;
            height: 280px;
            background: linear-gradient(145deg, white, #f8f9fa);
            border: 10px solid var(--sticker-red);
            padding: 12px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.6);
            border-radius: 12px;
            overflow: hidden;
            transition: left 0.6s ease-out, top 0.6s ease-out, transform 0.6s ease-out;
            z-index: 2;
        }

        .rarity-badge {
            position: absolute;
            top: 8px; right: 8px;
            background: var(--sticker-red);
            color: white;
            padding: 4px 12px;
            font-size: 0.75rem;
            font-weight: bold;
            transform: rotate(-20deg);
            border: 2px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            z-index: 4;
        }

        .sticker::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            transform: translateX(-100%);
            animation: stickerShine 1.5s 0.5s forwards;
        }

        @keyframes stickerShine {
            to { transform: translateX(100%); }
        }

        @keyframes flyInSticker {
            0% { transform: scale(0.3) translateX(600px) rotate(360deg); opacity: 0; }
            60% { transform: scale(1.15) translateX(-30px) rotate(-15deg); opacity: 1; }
            80% { transform: scale(0.95) translateX(15px) rotate(8deg); }
            100% { transform: scale(1) translateX(0) rotate(0deg); }
        }

        .wobble {
            animation: wobble 0.6s ease-in-out;
        }

        @keyframes wobble {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(6deg); }
            75% { transform: rotate(-4deg); }
        }

        @keyframes flyIn {
            0% { transform: translateY(200px) scale(0.5); opacity: 0; filter: brightness(2); }
            70% { transform: translateY(-20px) scale(1.05); }
            100% { transform: translateY(0) scale(1); opacity: 1; filter: brightness(1); }
        }

        .shaking { animation: shake 0.15s infinite; }
        @keyframes shake { 0% { transform: rotate(0deg); } 50% { transform: rotate(1.5deg); } 100% { transform: rotate(-1.5deg); } }

        .particle {
            position: absolute;
            width: 6px; height: 6px;
            background: radial-gradient(circle, var(--legendary-gold) 0%, var(--pvz-orange) 70%, transparent);
            border-radius: 50%;
            pointer-events: none;
            z-index: 20;
        }

        @media (max-width: 768px) {
            #album-view { flex-direction: column; padding: 20px; height: auto; }
            #hero-reveal, #sticker-zone { width: 100%; margin-bottom: 20px; }
            .hero-frame { width: 100%; height: auto; }
            .sticker { width: 120px; height: 170px; }
        }
    </style>
</head>
<body>

<div id="shop-view">
    <div class="envelope-realistic" id="pack" onclick="openPack()">
        <div class="star-abreme"><span>¡ÁBREME!</span></div>
    </div>
    <h2 id="pack-name" style="color: #4bcffa; text-shadow: 2px 2px #000; font-size: 2rem;"></h2>
</div>

<div id="album-view">
    <div id="hero-reveal">
        <div class="hero-banner">¡PERSONAJE DESBLOQUEADO!</div>
        <div class="hero-frame">
            <img id="hero-image" src="" style="width:100%; height:75%; object-fit:cover;" loading="lazy">
            <div style="padding: 15px; text-align: center; color: white; position: relative; z-index: 2;">
                <h2 id="hero-name" style="margin:0; font-size: 1.9rem;"></h2>
                <span id="hero-role" style="font-size: 1.1rem;"></span>
            </div>
        </div>
    </div>

    <div id="sticker-zone" onclick="revealNext()">
    </div>
</div>

<script>
    const teamMembers = [
      {
        id: 'vladimir-gonzalez',
        name: 'Lanza-Código',
        role: 'Defensor del Backend',
        packImage: '/members/vladimir-prime.jpeg',
        cardImage: '/members/vladimir.jpeg',
      },
      {
        id: 'william-martinez',
        name: 'Gira-Soles',
        role: 'Productor de UX',
        packImage: '/members/william-prime.png',
        cardImage: '/members/william.png',
      },
      {
        id: 'sebastian-acaro',
        name: 'ConsultaSETA BD',
        role: 'Consultas a la BD',
        packImage: '/members/sexbas-prime.jpeg',
        cardImage: '/members/sexbas.jpeg',
      },
      {
        id: 'erick-lopez',
        name: 'Pomelo-Project',
        role: 'Líder de Escuadrón',
        packImage: 'https://picsum.photos/seed/pvz-sun/400/400',
        cardImage: 'https://i.pravatar.cc/400?u=erick-lopez',
      },
      {
        id: 'pablo-lozada',
        name: 'Sombra-QA',
        role: 'Especialista en Bugs',
        packImage: 'https://picsum.photos/seed/pvz-moon/400/400',
        cardImage: 'https://i.pravatar.cc/400?u=pablo-lozada',
      },
      {
        id: 'juan-arcos',
        name: 'SCRIPT-KID',
        role: 'Arquitecto de Nube',
        packImage: '/members/juan-prime.jpeg',
        cardImage: '/members/juan.jpeg',
      }
    ];

    const urlParams = new URLSearchParams(window.location.search);
    const memberId = urlParams.get('member');
    const member = teamMembers.find(m => m.id === memberId);

    if (member) {
        document.getElementById('pack').style.backgroundImage = `url(${member.packImage})`;
        document.getElementById('pack-name').textContent = `PACK DE ${member.name.toUpperCase()}`;
        document.getElementById('hero-image').src = member.cardImage;
        document.getElementById('hero-name').textContent = member.name.toUpperCase();
        document.getElementById('hero-role').textContent = member.role.toUpperCase();
        document.querySelector('.hero-frame').onclick = () => { window.location.href = `/members/${member.id}`; };
        document.title = `PvZ GW2 - Pack Legendario ${member.name}`;
    } else {
        document.body.innerHTML = '<h1>Error: Miembro no encontrado. <a href="/">Volver</a></h1>';
    }

    const pack = document.getElementById('pack');
    const shop = document.getElementById('shop-view');
    const album = document.getElementById('album-view');
    const zone = document.getElementById('sticker-zone');
    const hero = document.getElementById('hero-reveal');

    const memes = ['/public/members/vladimir.jpeg', '/public/members/juan.jpeg', '/public/members/sexbas.jpeg', '/public/members/william.png'];

    let idx = 0;
    let isAnimating = false;
    let stickers = [];

    function playSound(freq, duration = 0.1, type = 'sine') {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.frequency.value = freq;
        oscillator.type = type;
        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + duration);
    }

    pack.addEventListener('mouseenter', () => pack.classList.add('shaking'));
    pack.addEventListener('mouseleave', () => pack.classList.remove('shaking'));

    function openPack() {
        if (!member) return;
        pack.style.transition = '0.6s ease-out';
        pack.style.transform = 'scale(1.6) rotate(15deg)';
        pack.style.opacity = '0';

        shake(shop, 800);
        playSound(440, 0.2);

        setTimeout(() => {
            shop.style.display = 'none';
            album.style.display = 'flex';
            revealNext();
        }, 600);
    }

    function revealNext() {
        if (isAnimating) return;
        isAnimating = true;

        const stickerW = 200;
        const stickerH = 280;
        const spacing = 45;

        const baseRight = zone.offsetWidth - stickerW - 30;
        const centerTop = (zone.offsetHeight - stickerH) / 2;

        stickers.forEach((sticker, i) => {
            const posFromRight = stickers.length - 1 - i;
            sticker.style.left = `${baseRight - (posFromRight * spacing)}px`;
            sticker.style.top = `${centerTop}px`;
            sticker.style.transform = `scale(0.92)`;
            sticker.style.zIndex = 10 + i;
        });

        if (idx < memes.length) {
            const s = document.createElement('div');
            s.className = 'sticker wobble';
            s.innerHTML = `
                <div class="rarity-badge">Raro</div>
                <img src="${memes[idx]}" style="width:100%; height:78%; object-fit:cover; border-radius:6px;">
                <div style="text-align:center; font-size:0.9rem; color:#555; padding-top:4px; font-weight:bold;">
                    Pegatina de meme
                </div>
            `;

            const newLeft = baseRight - (stickers.length * spacing);
            s.style.left = `${newLeft}px`;
            s.style.top = `${centerTop}px`;
            s.style.zIndex = 999;

            zone.appendChild(s);
            stickers.push(s);

            shake(album, 300);
            playSound(523 + idx * 100, 0.15);

            idx++;
            isAnimating = false;

        } else if (idx === memes.length) {
            revealHero();
        }
    }

    function revealHero() {
        hero.style.display = 'flex';
        album.style.filter = 'brightness(3)';
        setTimeout(() => (album.style.filter = 'brightness(1)'), 200);

        shake(album, 600);
        playSound(659, 0.4, 'sawtooth');
        playSound(784, 0.3, 'sawtooth');

        hero.style.animation = 'flyIn 1s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
        setTimeout(() => explode(hero, 60), 400);

        idx++;
        isAnimating = false;
    }

    function shake(element, duration = 500) {
        const originalTransform = element.style.transform || '';
        let startTime = null;
        const shakeIntensity = 15;

        function step(currentTime) {
            if (!startTime) startTime = currentTime;
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);

            if (progress < 1) {
                const shakeX = (Math.random() - 0.5) * shakeIntensity;
                const shakeY = (Math.random() - 0.5) * shakeIntensity;
                element.style.transform = `translate(${shakeX}px, ${shakeY}px) ${originalTransform}`;
                requestAnimationFrame(step);
            } else {
                element.style.transform = originalTransform;
            }
        }
        requestAnimationFrame(step);
    }

    function explode(container, count = 50) {
        const rect = container.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;

        for (let i = 0; i < count; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = `${centerX}px`;
            particle.style.top = `${centerY}px`;
            document.body.appendChild(particle);

            const angle = (i / count) * Math.PI * 2 + Math.random() * 0.5;
            const velocity = 150 + Math.random() * 250;
            const vx = Math.cos(angle) * velocity;
            const vy = Math.sin(angle) * velocity;
            const gravity = 400;

            let progress = 0;
            const duration = 2000;

            function animate() {
                progress += 16 / duration;
                if (progress > 1) {
                    particle.remove();
                    return;
                }

                const x = vx * progress;
                const y = vy * progress + 0.5 * gravity * progress * progress;
                const scale = 1 - progress;

                particle.style.transform = `translate(${x}px, ${y}px) scale(${scale})`;
                particle.style.opacity = 1 - progress;
                requestAnimationFrame(animate);
            }
            animate();
        }
    }
</script>

</body>
</html>
